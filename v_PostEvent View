create view v_PostEvent as
/*
This select gives a breakdown of usage by day 
Includes only the Marines
Shows only the Baseline Drills and completion of a Post Assessment
*/
select 
DATEFROMPARTS(
datepart(year,starttimestamp)
,datepart(month,starttimestamp)
,datepart(day,starttimestamp)
) DateYMD,
COUNT(distinct post.UserName) UniqueUsers,
--counts the total number of drill runs in the Post Assessment
count(distinct post.SessionLaneSubjectId) PostDrillsRun,
--counts the distinct numbers of drills in the Post Assessment that were run
count(distinct post.DrillDesc) PostDistinctDrills,
--calculates a completion percentage of the full Post Assessment
CAST(count(distinct post.SessionLaneSubjectId) as float)
/
CAST(count(distinct post.DrillDesc)*3*count(distinct post.UserName) as float) PostCompletion,
sum(Shots) RoundsFired
	from v_PostAssessmentSLSIDs post
	--joins to all session data from the view
	inner join v_SessionDetailLaneScore v
	on v.SessionLaneSubjectId = post.SessionLaneSubjectId
	--joins to isolate the Baseline Assessment drills
	inner join HPOBaselineDrills bd
	on v.DrillDesc = bd.Description
	--isolates Marines that correctly input EDIPI as the username as a 10-digit string
	where TRY_CAST(v.UserName as int) > 999999999
	--case: a user completed the Baseline Assessment over different days (at Lejeune)
	--and v.UserName = 1612910711
group by 
DATEFROMPARTS(
datepart(year,starttimestamp)
,datepart(month,starttimestamp)
,datepart(day,starttimestamp))
--order by 1 desc
